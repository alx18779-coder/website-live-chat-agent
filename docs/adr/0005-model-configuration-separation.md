# ADR-0005: 模型配置分离与平台扩展

**状态**: accepted  
**日期**: 2025-01-27  
**决策者**: AR (Architect AI)  
**相关文档**: Issue #18, Epic-002

---

## Context (背景)

当前系统的LLM模型和embedding模型使用相同的API配置，存在配置僵化、成本控制困难、性能优化受限、平台选择有限等问题。

## Decision (决策)

采用激进重构策略，实现插件化模型提供商架构，支持最大化的扩展性和灵活性。

### 核心实现

1. **插件化架构**: 创建统一的ModelProvider接口和抽象基类
2. **提供商插件**: 实现OpenAI、DeepSeek、硅基流动等提供商插件
3. **动态加载**: 支持配置动态加载和提供商注册
4. **统一接口**: 提供统一的模型创建和错误处理机制
5. **迁移工具**: 提供完整的配置迁移工具和文档

## Consequences (后果)

### ⚠️ 负面影响与风险

1. **配置复杂度增加** (🔴 高)
   - 缓解措施: 提供详细文档和配置验证工具
   
2. **混合模型性能不一致** (🟡 中)
   - 缓解措施: 性能监控和优化建议
   
3. **硅基流动平台依赖** (🟡 中)
   - 缓解措施: 多平台支持，降低单点依赖

### ✅ 正面影响

1. **配置灵活性提升**: 用户可根据需求选择最优模型组合
2. **成本优化**: 支持不同价位模型组合，实现成本效益最大化
3. **性能优化**: 支持选择最适合特定场景的模型组合
4. **平台扩展**: 支持更多部署平台，提升系统性能

### ⚙️ 技术债务

1. **配置文档维护**: 需要持续更新配置文档
2. **测试覆盖**: 需要维护混合模型组合的测试用例
3. **平台集成**: 需要维护多个平台的集成代码

---

## 技术约束与架构原则

### P0约束（必须遵守）
- 保持向后兼容性，现有配置必须继续工作
- 所有现有功能必须正常工作
- 配置验证必须检查各API的有效性

### P1约束（强烈建议）
- 提供清晰的配置文档和示例
- 配置错误时提供友好的错误信息
- 支持配置测试和验证功能

### P2约束（可选）
- 提供配置迁移工具
- 支持配置模板和预设

## 验证标准

1. **功能验证**: 所有混合模型组合正常工作
2. **性能验证**: 性能回归 ≤ 5%
3. **兼容性验证**: 现有配置继续工作
4. **文档验证**: 配置文档完整清晰

## 相关决策

- [ADR-0001: LangGraph架构](./0001-langgraph-architecture.md)
- [ADR-0002: Milvus集成](./0002-milvus-integration.md)
- [ADR-0003: 模型别名策略](./0003-model-alias-strategy.md)

## 参考资料

- Issue #18: 模型配置分离与平台扩展支持
- Epic-002: 模型配置分离与平台扩展
- Task File: project_document/proposals/issue-18-model-configuration-separation.md

---

**变更历史**:
| 日期 | 版本 | 变更内容 | 负责人 |
|---|---|-----|-----|
| 2025-01-27 | 1.0 | 初始版本，确定配置分离策略 | AR AI |
